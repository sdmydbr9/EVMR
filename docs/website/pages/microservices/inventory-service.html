<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Service - EVMR Documentation</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="docs-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo.svg" alt="EVMR Logo" class="logo">
                <h1>EVMR Docs</h1>
            </div>
            <div class="sidebar-search">
                <input type="text" id="search-input" placeholder="Search documentation...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-section">
                        <span class="section-title">Getting Started</span>
                        <ul>
                            <li><a href="../../index.html">Introduction</a></li>
                            <li><a href="../quickstart.html">Quick Start Guide</a></li>
                            <li><a href="../installation.html">Installation</a></li>
                        </ul>
                    </li>
                    <li class="nav-section">
                        <span class="section-title">Architecture</span>
                        <ul>
                            <li><a href="../architecture/overview.html">System Overview</a></li>
                            <li><a href="../architecture/microservices.html">Microservices</a></li>
                            <li><a href="../architecture/database.html">Database Schema</a></li>
                            <li><a href="../architecture/frontend.html">Frontend Structure</a></li>
                            <li><a href="../architecture/api-gateway.html">API Gateway</a></li>
                        </ul>
                    </li>
                    <li class="nav-section">
                        <span class="section-title">Microservices</span>
                        <ul>
                            <li><a href="auth-service.html">Auth Service</a></li>
                            <li><a href="patient-service.html">Patient Service</a></li>
                            <li><a href="appointment-service.html">Appointment Service</a></li>
                            <li><a href="inventory-service.html" class="active">Inventory Service</a></li>
                            <li><a href="reporting-service.html">Reporting Service</a></li>
                            <li><a href="notification-service.html">Notification Service</a></li>
                        </ul>
                    </li>
                    <li class="nav-section">
                        <span class="section-title">API Reference</span>
                        <ul>
                            <li><a href="../api/authentication.html">Authentication</a></li>
                            <li><a href="../api/patients.html">Patients</a></li>
                            <li><a href="../api/medical-records.html">Medical Records</a></li>
                            <li><a href="../api/appointments.html">Appointments</a></li>
                            <li><a href="../api/inventory.html">Inventory</a></li>
                            <li><a href="../api/reports.html">Reports</a></li>
                        </ul>
                    </li>
                    <li class="nav-section">
                        <span class="section-title">Deployment</span>
                        <ul>
                            <li><a href="../deployment/docker.html">Docker Deployment</a></li>
                            <li><a href="../deployment/configuration.html">Configuration</a></li>
                            <li><a href="../deployment/scaling.html">Scaling</a></li>
                            <li><a href="../deployment/monitoring.html">Monitoring</a></li>
                        </ul>
                    </li>
                    <li class="nav-section">
                        <span class="section-title">Guides</span>
                        <ul>
                            <li><a href="../guides/user-management.html">User Management</a></li>
                            <li><a href="../guides/patient-records.html">Patient Records</a></li>
                            <li><a href="../guides/appointments.html">Appointments</a></li>
                            <li><a href="../guides/reporting.html">Reporting</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="https://github.com/yourusername/EVMR" target="_blank">
                    <i class="fab fa-github"></i> GitHub
                </a>
                <a href="../contributing.html">
                    <i class="fas fa-code-branch"></i> Contributing
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="content-header">
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="header-links">
                    <a href="https://github.com/yourusername/EVMR" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="#" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                    </a>
                </div>
            </div>

            <div class="content-body">
                <h1>Inventory Service</h1>
                <p class="lead">
                    The Inventory Service manages medications, supplies, and equipment in the veterinary practice, tracking stock levels, usage, and procurement.
                </p>

                <nav class="page-toc">
                    <h3>On this page</h3>
                    <ul>
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#architecture">Architecture</a></li>
                        <li><a href="#key-features">Key Features</a></li>
                        <li><a href="#api-endpoints">API Endpoints</a></li>
                        <li><a href="#data-model">Data Model</a></li>
                        <li><a href="#configuration">Configuration</a></li>
                        <li><a href="#inventory-management">Inventory Management</a></li>
                        <li><a href="#integration">Integration with Other Services</a></li>
                        <li><a href="#deployment">Deployment</a></li>
                    </ul>
                </nav>

                <h2 id="overview">Overview</h2>
                <p>
                    The Inventory Service is responsible for tracking and managing all inventory items in the veterinary practice, including medications, supplies, and equipment. It provides functionality for stock management, usage tracking, reordering, and alerts for low stock levels.
                </p>

                <div class="info-box">
                    <h3>Service Details</h3>
                    <ul>
                        <li><strong>Port:</strong> 5104</li>
                        <li><strong>Base URL:</strong> <code>http://inventory-service:5104</code></li>
                        <li><strong>Technologies:</strong> Node.js, Express, MongoDB</li>
                        <li><strong>Dependencies:</strong> Auth Service</li>
                    </ul>
                </div>

                <h2 id="architecture">Architecture</h2>
                <p>
                    The Inventory Service follows a layered architecture pattern:
                </p>

                <div class="architecture-diagram">
                    <img src="../../images/inventory-service-architecture.png" alt="Inventory Service Architecture">
                    <p class="diagram-caption">Figure 1: Inventory Service internal architecture</p>
                </div>

                <h3>Components</h3>
                <ul>
                    <li><strong>API Layer:</strong> Express.js routes and controllers</li>
                    <li><strong>Service Layer:</strong> Business logic for inventory management</li>
                    <li><strong>Stock Management Engine:</strong> Handles stock levels, alerts, and reordering</li>
                    <li><strong>Data Access Layer:</strong> MongoDB models and repositories</li>
                    <li><strong>Integration Layer:</strong> Communication with other services</li>
                </ul>

                <h2 id="key-features">Key Features</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <h3>Inventory Tracking</h3>
                        <p>Track all inventory items and their details</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Stock Management</h3>
                        <p>Monitor stock levels and usage</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>Low Stock Alerts</h3>
                        <p>Automatic alerts for items below reorder level</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h3>Procurement</h3>
                        <p>Manage ordering and restocking process</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3>Usage Tracking</h3>
                        <p>Track item usage in treatments and procedures</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <h3>Expiration Management</h3>
                        <p>Monitor and alert for expiring items</p>
                    </div>
                </div>

                <h2 id="api-endpoints">API Endpoints</h2>
                <p>
                    The Inventory Service exposes the following RESTful API endpoints:
                </p>

                <h3>Inventory Management</h3>
                <div class="api-endpoints">
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory</div>
                        <div class="endpoint-description">List all inventory items (with filtering and pagination)</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory/:id</div>
                        <div class="endpoint-description">Get inventory item details by ID</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">POST</div>
                        <div class="endpoint-path">/api/inventory</div>
                        <div class="endpoint-description">Create a new inventory item</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">PUT</div>
                        <div class="endpoint-path">/api/inventory/:id</div>
                        <div class="endpoint-description">Update inventory item details</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">DELETE</div>
                        <div class="endpoint-path">/api/inventory/:id</div>
                        <div class="endpoint-description">Remove inventory item</div>
                    </div>
                </div>

                <h3>Stock Management</h3>
                <div class="api-endpoints">
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory/low-stock</div>
                        <div class="endpoint-description">Get items with low stock levels</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory/expiring</div>
                        <div class="endpoint-description">Get items nearing expiration</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">POST</div>
                        <div class="endpoint-path">/api/inventory/:id/restock</div>
                        <div class="endpoint-description">Restock inventory item</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">POST</div>
                        <div class="endpoint-path">/api/inventory/:id/use</div>
                        <div class="endpoint-description">Record usage of inventory item</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">PATCH</div>
                        <div class="endpoint-path">/api/inventory/:id/stock</div>
                        <div class="endpoint-description">Update stock level</div>
                    </div>
                </div>

                <h3>Categories and Reporting</h3>
                <div class="api-endpoints">
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory/categories</div>
                        <div class="endpoint-description">Get all inventory categories</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory/usage-report</div>
                        <div class="endpoint-description">Generate inventory usage report</div>
                    </div>
                    <div class="endpoint">
                        <div class="endpoint-method">GET</div>
                        <div class="endpoint-path">/api/inventory/alerts/low-stock</div>
                        <div class="endpoint-description">Get low stock alerts</div>
                    </div>
                </div>

                <h2 id="data-model">Data Model</h2>
                <p>
                    The Inventory Service uses MongoDB to store inventory data.
                </p>

                <h3>Inventory Schema</h3>
                <div class="code-block">
                    <pre><code>{
  _id: ObjectId,
  name: {
    type: String,
    required: true,
    trim: true
  },
  category: {
    type: String,
    required: true,
    enum: ['Vaccines', 'Medications', 'Supplies', 'Equipment', 'Food', 'Other']
  },
  quantity: {
    type: Number,
    required: true,
    min: 0
  },
  usageCount: {
    type: Number,
    default: 0
  },
  unit: {
    type: String,
    required: true
  },
  cost: {
    type: Number,
    required: true,
    min: 0
  },
  reorderLevel: {
    type: Number,
    required: true,
    min: 0
  },
  expiryDate: {
    type: Date
  },
  supplier: {
    type: String
  },
  location: {
    type: String
  },
  notes: {
    type: String
  },
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
}</code></pre>
                </div>

                <h3>Transaction Schema</h3>
                <div class="code-block">
                    <pre><code>{
  _id: ObjectId,
  inventoryId: {
    type: mongoose.Schema.Types.ObjectId,
    required: true,
    ref: 'Inventory'
  },
  type: {
    type: String,
    required: true,
    enum: ['restock', 'use', 'adjustment', 'write-off']
  },
  quantity: {
    type: Number,
    required: true
  },
  previousQuantity: {
    type: Number,
    required: true
  },
  newQuantity: {
    type: Number,
    required: true
  },
  reason: {
    type: String
  },
  performedBy: {
    type: mongoose.Schema.Types.ObjectId,
    required: true
  },
  patientId: {
    type: mongoose.Schema.Types.ObjectId
  },
  appointmentId: {
    type: mongoose.Schema.Types.ObjectId
  },
  createdAt: {
    type: Date,
    default: Date.now
  }
}</code></pre>
                </div>

                <h2 id="configuration">Configuration</h2>
                <p>
                    The Inventory Service is configured using environment variables:
                </p>

                <div class="code-block">
                    <pre><code># Server Configuration
PORT=5104
NODE_ENV=development

# MongoDB Configuration
MONGODB_URI=mongodb://mongodb:27017/inventory-service

# Service Dependencies
AUTH_SERVICE_URL=http://auth-service:5101

# Inventory Configuration
LOW_STOCK_THRESHOLD_PERCENTAGE=20
EXPIRY_WARNING_DAYS=30

# Logging
LOG_LEVEL=info</code></pre>
                </div>

                <h2 id="inventory-management">Inventory Management</h2>
                <p>
                    The Inventory Service implements several key inventory management features:
                </p>

                <h3>Stock Level Monitoring</h3>
                <p>
                    The service continuously monitors stock levels and compares them against reorder levels. When an item's quantity falls below its reorder level, it generates an alert.
                </p>

                <div class="code-block">
                    <pre><code>// Example low stock check
const checkLowStock = async () => {
  const lowStockItems = await Inventory.find({
    $expr: {
      $lte: ['$quantity', '$reorderLevel']
    }
  });
  
  return lowStockItems;
};</code></pre>
                </div>

                <h3>Expiration Tracking</h3>
                <p>
                    For items with expiration dates (like medications and vaccines), the service tracks approaching expiration dates and generates alerts when items are nearing expiration.
                </p>

                <h3>Transaction Logging</h3>
                <p>
                    Every inventory change (restock, usage, adjustment) is recorded in the transaction log, providing a complete audit trail of inventory movements.
                </p>

                <h3>Usage Analytics</h3>
                <p>
                    The service tracks item usage patterns to help with forecasting and inventory optimization.
                </p>

                <h2 id="integration">Integration with Other Services</h2>
                <p>
                    The Inventory Service integrates with other microservices in the following ways:
                </p>

                <h3>Auth Service Integration</h3>
                <p>
                    The Inventory Service relies on the Auth Service for authentication and authorization. It validates JWT tokens and retrieves user information.
                </p>

                <h3>Patient Service Integration</h3>
                <p>
                    When recording inventory usage for a specific patient, the Inventory Service validates the patient ID with the Patient Service.
                </p>

                <h3>Appointment Service Integration</h3>
                <p>
                    When recording inventory usage for a specific appointment, the Inventory Service validates the appointment ID with the Appointment Service.
                </p>

                <h3>Reporting Service Integration</h3>
                <p>
                    The Inventory Service provides inventory data to the Reporting Service for generating comprehensive reports.
                </p>

                <h2 id="deployment">Deployment</h2>
                <p>
                    The Inventory Service is deployed as a Docker container as part of the EVMR microservices architecture.
                </p>

                <h3>Docker Configuration</h3>
                <div class="code-block">
                    <pre><code># From docker-compose.yml
inventory-service:
  build:
    context: ./services/inventory-service
    dockerfile: Dockerfile
  container_name: petsphere-inventory-service
  restart: unless-stopped
  ports:
    - "5104:5104"
  depends_on:
    mongodb:
      condition: service_healthy
    auth-service:
      condition: service_healthy
  environment:
    - NODE_ENV=${NODE_ENV}
    - PORT=5104
    - MONGODB_URI=mongodb://mongodb:27017/inventory-service
    - AUTH_SERVICE_URL=http://auth-service:5101
    - LOW_STOCK_THRESHOLD_PERCENTAGE=20
    - EXPIRY_WARNING_DAYS=30
    - LOG_LEVEL=info
  env_file:
    - .env
  networks:
    - petsphere-network
  healthcheck:
    test: ["CMD", "wget", "-qO-", "http://localhost:5104/health"]
    interval: 30s
    timeout: 5s
    retries: 3
    start_period: 30s</code></pre>
                </div>

                <div class="next-section">
                    <h3>Next Steps</h3>
                    <p>Now that you understand the Inventory Service, you can explore:</p>
                    <ul>
                        <li><a href="../api/inventory.html">Inventory API Reference</a></li>
                        <li><a href="reporting-service.html">Reporting Service Documentation</a></li>
                    </ul>
                </div>
            </div>

            <footer class="content-footer">
                <p>&copy; 2023 EVMR Documentation. All rights reserved.</p>
                <p>
                    <a href="../privacy.html">Privacy Policy</a> |
                    <a href="../terms.html">Terms of Service</a> |
                    <a href="../contact.html">Contact</a>
                </p>
            </footer>
        </main>
    </div>

    <script src="../../js/main.js"></script>
</body>
</html>
